Understanding workflow output
=============================


The pipeline outputs are writtent to a results directory
(``--outdir`` default is ``./results/``) that contains three subdirectories:

- ``score/``
- ``match/``
- ``pipeline_info/``

``score/``
---------

Calculated scores are stored in a gzipped-text space-delimted text file called
``aggregated_scores`` that is labelled with the date/time (e.g. ``aggregated_scores_YYYY_MM_DD_HH_MM_SS.txt.gz``).
Each row represents an individual, and there should be at least three columns with the following headers:

- dataset: the name of the input dataset
- IID: the name of each sample
- PGS001229_22_SUM: this is the name of the calculated score. It will be
  different depending on which scores you have chosen to use. 

At least one score must be present in this file (the third column). Extra
columns might be present if you calculated more than one score,
or if you calculated the PGS on a dataset with a small sample size (n < 50,
in this cases a column with the _AVG PGS across non-missing genotypes will be added).

A summary report is also available (``report.html``). The report should open in
a web browser and contain useful information about the PGS that were applied,
how well the variants match with the genotyping data, and some simple graphs
displaying the distribution of scores in your dataset(s).

``match/``
---------

This directory contains the raw data that is summarised in the scoring
report. The log file is a :term:`CSV` that contains a row for each variant in
the aggregated input scoring files. Columns contain information about how each
variant was matched against the target genomes. For example, a variant in a
scoring file may be:

- Simple to match, with the effect allele being REF and the other allele being
  ALT in the target genomes
- Lifted from its original genome build to match the target genome build
- The effect allele may have matched ALT and the other allele may have matched
  REF in the target genomes

This information might be useful to debug a score that is causing problems.

Processed scoring files are also present in this directory. Briefly, variants in
the scoring files are matched against the target genomes. Common variants across
different scores are combined (left joined, so each score is an additional
column). The combined scores are then partially split to overcome PLINK2
technical limitations (e.g. calculating different effect types such as dominant
/ recessive). Once scores are calculated from these partially split scoring
files, scores are aggregated to produce the final results in ``score/``.

``pipeline_info/``
------------------

Summary reports generated by nextflow describes the execution of the pipeline in
a lot of technical detail. The execution report can be useful to see how long a
job takes to execute, and how much memory/cpu has been allocated (or overallocated)
to specific jobs. The DAG is a diagram that may be useful to understand how
the pipeline processes data. 
