# ancestry test notes:
# need to stage reference in $ANCESTRY_REF_DIR
# extract target in $ANCESTRY_TARGET_DIR

- name: test ancestry projection and scoring
  command: >
    bash -c "
    sed \"s|ANCESTRY_TARGET_DIR|$ANCESTRY_TARGET_DIR|\" tests/ancestry/samplesheet.csv > samplesheet.csv;
    nextflow run main.nf -c ./tests/config/nextflow.config \
      -profile test \
      --input samplesheet.csv \
      --run_ancestry $ANCESTRY_REF_DIR/GRCh38_HAPNEST_reference.tar.zst \
      --target_build GRCh38 \
      --pgs_id PGS001229 \
      --min_overlap 0.50 \
      --target_build GRCh38
    "
  tags:
    - ancestry
    - slow
  stdout:
    contains:
      - "Pipeline completed successfully"
  files:
    - path: "output/test/score/pop_summary.csv"
      contains:
        - "AFR,100 (33.33%)"
        - "EAS,100 (33.33%)"
        - "EUR,100 (33.33%)"
      
